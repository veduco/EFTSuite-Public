<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EFTSuite Converter</title>
    <link rel="icon" type="image/png" href="static/favico.png">
    <link rel="stylesheet" href="static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Specific styles for Edit view */
        .raw-view-header {
            background: #444;
            padding: 10px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .raw-view-content {
            background: #222;
            padding: 10px;
            border-radius: 4px;
            margin-top: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }

        .raw-view-content.show {
            display: block;
        }

        .mode-selection-card {
            background: #333;
            border: 1px solid #555;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .mode-selection-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent-color);
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo-container">
                <img src="static/eftsuitelogo.png" alt="EFTSuite">
            </div>
            <ul class="nav-links">
                <li class="active" onclick="location.reload()">New EFT</li>
                <li id="nav-capture">Capture Prints</li>
                <li id="nav-edit">View/Edit EFT</li>
                <hr style="border: 0; border-top: 1px solid #555; margin: 10px 20px;">
                <li id="nav-info">Info</li>
                <li id="nav-settings">Settings</li>
                <li id="nav-about">About</li>
            </ul>
            <div style="flex: 1"></div>
            <div style="padding: 20px; color: #555; font-size: 0.8rem; text-align: center; border-top: 1px solid #555;">
                <div style="margin-bottom: 5px;">v2.0.3</div>
                <div id="latest-version-container">Latest: <span id="latest-version-text">...</span></div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <header class="top-bar">
                <h1>Fingerprint Card Processing</h1>
                <div></div>
            </header>

            <!-- Wizard Progress (Only for New EFT) -->
            <div class="wizard-progress" id="wizard-progress-bar">
                <div class="progress-labels">
                    <div class="progress-step active" id="p-step-1">1. Print Cards</div>
                    <div class="progress-step" id="p-step-2">2. Personal Details</div>
                    <div class="progress-step" id="p-step-3">3. Review</div>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">

                <!-- CAPTURE PRINTS SECTION -->
                <div id="section-capture-prints" class="hidden">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Live Capture</h2>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div id="scanner-status"
                                style="padding: 5px 10px; border-radius: 4px; background: #555; font-size: 0.9rem;">
                                ⚪ Scanner Disconnected
                            </div>
                            <div style="position: relative;">
                                <button id="btn-scanner-settings" class="btn btn-secondary" style="padding: 5px 10px;"
                                    title="Scanner Settings">
                                    ⚙️ Config
                                </button>
                                <div id="config-tooltip"
                                    style="position: absolute; top: 120%; right: 0; background: #222; border: 1px solid #444; padding: 10px; border-radius: 4px; width: 220px; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.5);">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                        <strong style="font-size: 0.75rem; color: #888;">TIP</strong>
                                        <span style="cursor: pointer; color: #aaa; font-size: 1rem; line-height: 0.5;"
                                            onclick="document.getElementById('config-tooltip').style.display='none'">&times;</span>
                                    </div>
                                    <p style="font-size: 0.8rem; margin: 0; color: #ccc; line-height: 1.3;">
                                        Click here to change the address of the helper - useful if you are using <a
                                            href="https://github.com/Robbbbbbbbb/portaprint-public" target="_blank"
                                            style="color: var(--accent-color); text-decoration: none;">Portaprint</a>
                                        from
                                        a remote computer.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Modal (Hidden by default) -->
                    <div id="scanner-settings-modal" class="hidden"
                        style="background: #222; padding: 20px; border-radius: 8px; border: 1px solid #444; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">Scanner Connection Settings</h3>
                        <div style="display: flex; gap: 15px; align-items: flex-end;">
                            <div class="form-group" style="flex: 2;">
                                <label>Scanner IP Address</label>
                                <input type="text" id="setting-scanner-ip" placeholder="localhost" value="localhost">
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label>Port</label>
                                <input type="text" id="setting-scanner-port" placeholder="8888" value="8888">
                            </div>
                            <div style="padding-bottom: 2px;">
                                <button id="btn-save-settings" class="btn">Save & Connect</button>
                                <button id="btn-cancel-settings" class="btn btn-secondary"
                                    style="margin-left: 5px;">Cancel</button>
                                <button id="btn-reset-settings" class="btn btn-secondary"
                                    style="margin-left: 5px;">Reset Defaults</button>
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <!-- Mode Selection (New) -->
                        <div id="capture-mode-select" style="text-align: center; padding: 40px 0;">
                            <h2 style="margin-bottom: 30px;">Start Capture</h2>
                            <div
                                style="display: flex; gap: 20px; justify-content: center; flex-direction: column; align-items: center;">
                                <div class="mode-selection-card" id="btn-cap-mode-slaps"
                                    style="max-width: 300px; margin-bottom: 20px; display: none;">
                                    <h3>Type-14 (Slaps Only)</h3>
                                    <p>Capture Legacy Slaps</p>
                                    <small style="color: #aaa;">(Left, Right, Thumbs)</small>
                                </div>

                                <div class="mode-selection-card" id="btn-cap-mode-full" style="max-width: 300px;">
                                    <h3>Start Capture Session</h3>
                                    <p>Full Fingerprint Card</p>
                                    <small style="color: #aaa;">(14 Images: Rolled + Plains)</small>
                                </div>

                                <div style="margin-top: 20px;">
                                    <label
                                        style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                                        <input type="checkbox" id="chk-express-mode"
                                            style="width: 20px; height: 20px; margin-right: 10px;">
                                        <div style="text-align: left;">
                                            <span style="font-weight: bold; font-size: 1.1rem;">Express Mode</span><br>
                                            <small style="color: #aaa;">Auto-accept prints (No confirmation
                                                needed)</small>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Capture Wizard Container -->
                        <div id="capture-wizard" class="hidden">
                            <!-- Capture Steps -->
                            <div class="wizard-progress" style="margin-bottom: 20px;">
                                <div class="progress-labels" id="capture-progress-labels">
                                    <!-- Injected by JS -->
                                </div>
                            </div>

                            <!-- Live Preview / Result -->
                            <div style="display: flex; gap: 20px;">
                                <!-- Main Preview -->
                                <div
                                    style="flex: 2; text-align: center; background: #222; padding: 20px; border-radius: 8px;">
                                    <h3 id="capture-instruction">Instructions...</h3>
                                    <div
                                        style="position: relative; margin: 20px auto; min-height: 300px; display: flex; align-items: center; justify-content: center;">
                                        <img id="scanner-preview"
                                            style="max-width: 100%; max-height: 400px; border: 2px dashed #444;">
                                        <div id="capture-overlay"
                                            style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center; justify-content: center; pointer-events: none;">
                                            <!-- Overlays like 'Good', 'Bad' can go here -->
                                        </div>
                                    </div>
                                    <div style="display: flex; justify-content: center; gap: 10px;">
                                        <button id="btn-cap-start" class="btn">Start Capture</button>
                                        <button id="btn-cap-skip" class="btn btn-secondary"
                                            style="background: #e67e22; color: white;">Skip (Unprintable)</button>
                                        <button id="btn-cap-cancel" class="btn btn-secondary hidden">Cancel</button>
                                        <button id="btn-cap-accept" class="btn hidden"
                                            style="background: var(--accent-color); color: #000;">Accept & Next</button>
                                        <button id="btn-cap-retry" class="btn btn-secondary hidden">Retry</button>
                                        <button id="btn-cap-reset" class="btn btn-secondary hidden"
                                            style="margin-left: 10px; background: #e74c3c; color: white;">Reset
                                            All</button>
                                    </div>
                                </div>

                                <!-- Mini Gallery of Captured -->
                                <div
                                    style="flex: 1; display: flex; flex-direction: column; gap: 10px; max-height: 600px;">
                                    <div id="capture-gallery-container"
                                        style="flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 10px;">
                                        <!-- Injected by JS -->
                                    </div>
                                    <button id="btn-cap-finalize" class="btn hidden" style="margin-top: 10px;">Done -
                                        Create EFT</button>
                                </div>
                            </div>
                        </div>

                        <!-- Console Output -->
                        <div
                            style="margin-top: 20px; background: #111; color: #0f0; padding: 10px; border-radius: 4px; font-family: monospace; height: 150px; overflow-y: auto;">
                            <div id="console-output">Debug Log...</div>
                        </div>
                    </div>
                </div>

                <!-- NEW EFT SECTION -->
                <div id="section-new-eft">
                    <!-- Step 1: Upload and Crop -->
                    <div id="step-1-panel" class="panel">

                        <!-- View: Upload -->
                        <div id="view-upload">
                            <div class="upload-area">
                                <h2>Upload Fingerprint Card</h2>
                                <p>Select a high-resolution scan (600 DPI recommended) of an FD-258 card.</p>
                                <br>
                                <input type="file" id="file-input" accept="image/*,.pdf" class="hidden">
                                <button class="btn" onclick="document.getElementById('file-input').click()">Choose
                                    File</button>
                            </div>
                        </div>

                        <!-- View: PPI Warning -->
                        <div id="view-warning" class="hidden"
                            style="text-align: center; max-width: 500px; margin: 0 auto;">
                            <h2 style="margin-bottom: 20px; color: #e74c3c;">⚠️ Low Resolution</h2>
                            <p id="warning-text" style="color: #ccc; margin-bottom: 30px; line-height: 1.5;">
                                WARNING: The uploaded image has a low resolution. You must only procee.
                            </p>
                            <div style="display: flex; gap: 20px; justify-content: center;">
                                <button id="btn-warn-back" class="btn btn-secondary">Try Different File</button>
                                <button id="btn-warn-proceed" class="btn"
                                    style="background: #e67e22; color: white;">Proceed
                                    Anyway</button>
                            </div>
                        </div>

                        <!-- View: PDF Page Selection -->
                        <div id="view-pdf-select" class="hidden">
                            <h2 style="text-align: center; margin-bottom: 20px;">Select Page to Import</h2>
                            <p style="text-align: center; color: #aaa; margin-bottom: 20px;">The uploaded PDF has
                                multiple pages. Please select one to process.</p>
                            <div id="pdf-pages-container"
                                style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; max-height: 500px; overflow-y: auto;">
                                <!-- Pages injected here -->
                            </div>
                            <div style="text-align: center; margin-top: 20px;">
                                <button id="btn-cancel-pdf" class="btn btn-secondary">Cancel</button>
                            </div>
                        </div>

                        <!-- View: Crop & Rotate -->
                        <div id="view-crop" class="hidden">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <h3>Crop Card Area</h3>
                                <div>
                                    <button id="btn-rotate-left" class="btn btn-secondary">↶ Rotate</button>
                                    <button id="btn-rotate-right" class="btn btn-secondary">↷ Rotate</button>
                                    <button id="btn-reset-crop" class="btn btn-secondary">Reset</button>
                                </div>
                            </div>
                            <div class="canvas-wrapper">
                                <canvas id="crop-canvas"></canvas>
                            </div>
                            <p style="text-align: center; margin-top: 10px; color: var(--text-muted);">
                                Drag to select the fingerprint area.
                            </p>
                        </div>

                        <!-- View: Mode Selection (New) -->
                        <div id="view-mode-select" class="hidden">
                            <h2 style="text-align:center; margin-bottom:30px;">Select Generation Mode</h2>
                            <div style="display: flex; gap: 20px; justify-content: center;">
                                <div class="mode-selection-card" id="btn-gen-atf"
                                    style="opacity: 0.5; cursor: not-allowed;">
                                    <h3>Type-14 (Legacy)</h3>
                                    <p>Standard Type-14 Records</p>
                                    <small style="color: #aaa;">(Left Slap, Right Slap, Thumbs)</small>
                                    <div style="color: #ff4444; font-size: 0.8rem; margin-top: 5px;">No longer supported
                                    </div>
                                </div>
                                <div class="mode-selection-card" id="btn-gen-rolled">
                                    <h3>Rolled Prints</h3>
                                    <p>Full Type-4 Records</p>
                                    <small style="color: #aaa;">(10 Rolled + 4 Plain)</small>
                                </div>
                            </div>
                        </div>

                        <!-- View: Box Selection -->
                        <div id="view-box" class="hidden">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <h3 id="box-selection-title">Select Print Areas</h3>
                                <div class="toolbar">
                                    <span style="margin-right: 10px; color: var(--accent-color);">Drag boxes to
                                        align</span>
                                </div>
                            </div>
                            <div class="canvas-wrapper">
                                <canvas id="editor-canvas"></canvas>
                            </div>
                        </div>

                    </div>

                    <!-- Step 2: Form Data -->
                    <div id="step-2-panel" class="panel hidden">
                        <form id="type2-form">
                            <!-- 1. Personal Details -->
                            <div class="form-section">
                                <h3>Personal Details</h3>
                                <div class="form-grid-2-col">
                                    <div class="form-group">
                                        <label>First Name</label>
                                        <input type="text" id="fname" name="fname" required class="sentence-case">
                                    </div>

                                    <div class="form-group">
                                        <label>Middle Name (Optional)</label>
                                        <div style="display: flex; gap: 10px;">
                                            <input type="text" id="mname" name="mname" class="sentence-case"
                                                style="flex:1">
                                            <label style="display: flex; align-items: center; white-space: nowrap;">
                                                <input type="checkbox" id="no-mn"
                                                    style="width: auto; margin-right: 5px;"> NMN
                                            </label>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>Last Name</label>
                                        <input type="text" id="lname" name="lname" required class="sentence-case">
                                    </div>

                                    <div class="form-group">
                                        <label>Date of Birth</label>
                                        <input type="date" id="dob-input" name="dob" required>
                                    </div>

                                    <div class="form-group">
                                        <label>Place of Birth</label>
                                        <select name="2.020" id="pob-select" required></select>
                                    </div>
                                    <div class="form-group">
                                        <label>Citizenship</label>
                                        <select name="2.021" id="ctz-select" required></select>
                                    </div>

                                    <div class="form-group span-full"
                                        style="display: flex; align-items: center; justify-content: space-between; background: #222; padding: 10px; border-radius: 4px; margin-bottom: 5px;">
                                        <div style="font-size: 0.9rem;">
                                            <span style="color: #aaa;">List Source:</span>
                                            <span id="codes-source-indicator"
                                                style="font-weight: bold; margin-left: 5px;">...</span>
                                        </div>
                                        <button type="button" id="btn-reload-codes" class="btn btn-secondary"
                                            style="padding: 2px 10px; font-size: 0.8rem;">
                                            ↻ Reload
                                        </button>
                                    </div>

                                    <div class="form-group span-full">
                                        <label>Social Security Number ⓘ</label>
                                        <div style="display: flex; gap: 10px; align-items: center;">
                                            <input type="text" name="2.016" required pattern="\d{9}"
                                                placeholder="xxxxxxxxx" style="flex: 1;">
                                            <label
                                                style="display: flex; align-items: center; white-space: nowrap; font-size: 0.9rem;">
                                                <input type="checkbox" id="bypass-ssn"
                                                    style="width: auto; margin-right: 5px;"> Bypass SSN
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 2. Contact and Address -->
                            <div class="form-section">
                                <h3>Contact & Address</h3>
                                <div class="form-grid-2-col">
                                    <div class="form-group span-full">
                                        <label>Street Address</label>
                                        <input type="text" name="addr_street" required>
                                    </div>

                                    <div class="form-group">
                                        <label>City</label>
                                        <input type="text" name="addr_city" required>
                                    </div>
                                    <div class="form-group">
                                        <label>State</label>
                                        <select name="addr_state" id="addr-state" required></select>
                                    </div>

                                    <div class="form-group">
                                        <label>ZIP Code</label>
                                        <input type="text" name="addr_zip" required>
                                    </div>
                                </div>
                            </div>

                            <!-- 3. Demographic Details -->
                            <div class="form-section">
                                <h3>Demographic Details</h3>
                                <div class="form-grid-2-col">
                                    <div class="form-group">
                                        <label>Sex</label>
                                        <select name="2.024" required>
                                            <option value="">Select...</option>
                                            <option value="M">Male</option>
                                            <option value="F">Female</option>
                                            <option value="X">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Race</label>
                                        <select name="2.025" required>
                                            <option value="">Select...</option>
                                            <option value="A">Asian</option>
                                            <option value="B">Black</option>
                                            <option value="I">American Indian</option>
                                            <option value="W">White / Hispanic</option>
                                            <option value="U">Unknown</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label>Height</label>
                                        <select id="height-select" name="2.027" required></select>
                                    </div>
                                    <div class="form-group">
                                        <label>Weight (lbs)</label>
                                        <input type="number" name="2.029" min="0" max="499" required>
                                    </div>

                                    <div class="form-group">
                                        <label>Eye Color</label>
                                        <select name="2.031" required>
                                            <option value="">Select...</option>
                                            <option value="BLK">Black</option>
                                            <option value="BLU">Blue</option>
                                            <option value="BRO">Brown</option>
                                            <option value="GRY">Gray</option>
                                            <option value="GRN">Green</option>
                                            <option value="HAZ">Hazel</option>
                                            <option value="MUL">Multi-Colored</option>
                                            <option value="XXX">Unknown</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label>Hair Color</label>
                                        <select name="2.032" required>
                                            <option value="">Select...</option>
                                            <option value="BAL">Bald</option>
                                            <option value="BLK">Black</option>
                                            <option value="BLN">Blonde</option>
                                            <option value="BRO">Brown</option>
                                            <option value="GRY">Gray</option>
                                            <option value="RED">Red</option>
                                            <option value="XXX">Unknown</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Step 3: Review -->
                    <div id="step-3-panel" class="panel hidden">
                        <div class="review-grid">
                            <div class="review-summary">
                                <h3>Summary</h3>
                                <div id="summary-content"></div>
                            </div>
                            <div class="review-images-container">
                                <h3>Fingerprint Crops</h3>
                                <div id="review-dynamic-container"
                                    style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                                    <!-- Dynamic Content -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View/Edit EFT Sesion -->
                <div id="section-edit-eft" class="hidden">
                    <h2 style="margin-bottom: 20px;">View / Edit EFT</h2>

                    <!-- View: Upload EFT -->
                    <div id="edit-view-upload" class="panel">
                        <div class="upload-area">
                            <h2>Upload Existing EFT File</h2>
                            <p>Select an existing .EFT file to view or modify.</p>
                            <br>
                            <input type="file" id="eft-file-input" class="hidden">
                            <button class="btn" onclick="document.getElementById('eft-file-input').click()">Choose
                                File</button>
                        </div>
                    </div>

                    <!-- View: Mode Selection -->
                    <div id="edit-view-mode" class="panel hidden">
                        <div style="display: flex; gap: 20px; justify-content: center; margin-top: 50px;">
                            <div class="mode-selection-card" id="btn-mode-read">
                                <h3>Read Only</h3>
                                <p>View contents securely without modifying.</p>
                            </div>
                            <div class="mode-selection-card" id="btn-mode-edit">
                                <h3>Edit Mode</h3>
                                <p>Unlock fields for advanced editing.</p>
                            </div>
                        </div>
                    </div>

                    <!-- View: Editor/Viewer -->
                    <div id="edit-view-main" class="panel hidden">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 id="editor-title">EFT Content</h3>
                            <button id="btn-save-eft" class="btn hidden">Save & Export</button>
                        </div>

                        <!-- Raw Data Toggle -->
                        <div class="raw-view-header"
                            onclick="document.getElementById('raw-content').classList.toggle('show')">
                            <span>Raw Data Inspector (an2k)</span>
                            <span style="font-size: 0.8rem;">▼</span>
                        </div>
                        <div id="raw-content" class="raw-view-content">Loading...</div>

                        <br>

                        <!-- Editor Form -->
                        <form id="edit-form">
                            <div class="form-grid" id="edit-form-grid">
                                <!-- Fields injected by JS -->
                            </div>
                        </form>

                        <br>

                        <!-- Image Gallery -->
                        <h3>Embedded Fingerprints</h3>
                        <div class="review-images-container">
                            <div id="edit-img-container"
                                style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                                <!-- Images injected by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Content Sesion -->
                <div id="section-dynamic-content" class="hidden">
                    <h2 id="dynamic-title" style="margin-bottom: 20px;"></h2>
                    <div id="dynamic-content-body" class="panel">
                        <!-- Content injected here -->
                    </div>
                </div>

                <!-- SETTINGS SECTION -->
                <div id="section-settings" class="hidden">
                    <h2 style="margin-bottom: 20px;">Settings</h2>

                    <div class="panel">
                        <!-- Display Options -->
                        <div class="form-section" style="margin-bottom: 30px;">
                            <h3>Display Options</h3>
                            <label style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                                <input type="checkbox" id="setting-show-capture"
                                    style="width: 20px; height: 20px; margin-right: 10px;">
                                <span>Show "Capture Prints" in Sidebar</span>
                            </label>
                        </div>

                        <!-- Live Scanner Config -->
                        <div class="form-section" style="margin-bottom: 30px;">
                            <h3>Live Scanner Configuration</h3>
                            <p style="color: #aaa; margin-bottom: 15px;">Configure the connection to the scanner helper
                                service.</p>
                            <div style="display: flex; gap: 20px;">
                                <div class="form-group" style="flex: 1;">
                                    <label>Scanner IP Address</label>
                                    <input type="text" id="setting-config-ip" placeholder="localhost">
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <label>Port</label>
                                    <input type="text" id="setting-config-port" placeholder="8888">
                                </div>
                            </div>
                            <div style="text-align: right; margin-top: 10px;">
                                <button id="btn-save-config" class="btn">Save Configuration</button>
                            </div>
                        </div>

                        <!-- Type-14 Capture -->
                        <div class="form-section" style="margin-bottom: 30px;">
                            <h3>Legacy Support</h3>
                            <label style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                                <input type="checkbox" id="setting-enable-type14"
                                    style="width: 20px; height: 20px; margin-right: 10px;">
                                <div>
                                    <span>Enable Type-14 Capture</span><br>
                                    <small style="color: #aaa;">Re-enables legacy Type-14 (Slaps + Thumbs) capture mode
                                        for Live Scan and New EFT.</small>
                                </div>
                            </label>
                        </div>

                        <!-- Data Source -->
                        <div class="form-section" style="margin-bottom: 30px;">
                            <h3>Data Source (Codes.js)</h3>
                            <p style="color: #aaa; margin-bottom: 15px;">Choose where to load the state and country
                                codes from.</p>

                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="codes-source" value="github" checked
                                        style="width: 20px; height: 20px; margin-right: 10px;">
                                    <div>
                                        <span>Use Latest from GitHub (Default)</span>
                                        <div style="font-size: 0.8rem; color: #888;">
                                            https://raw.githubusercontent.com/Robbbbbbbbb/EFTSuite-Public/.../codes.js
                                        </div>
                                    </div>
                                </label>

                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="codes-source" value="custom"
                                        style="width: 20px; height: 20px; margin-right: 10px;">
                                    <span>Use Custom URL</span>
                                </label>
                                <div id="custom-codes-url-container" style="margin-left: 30px; display: none;">
                                    <input type="text" id="setting-custom-codes-url"
                                        placeholder="https://example.com/codes.js" style="width: 100%;">
                                </div>

                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" name="codes-source" value="local"
                                        style="width: 20px; height: 20px; margin-right: 10px;">
                                    <span>Use Local File (Offline)</span>
                                </label>
                            </div>
                        </div>

                        <!-- Demographic Defaults -->
                        <div class="form-section">
                            <h3>Demographic Defaults</h3>
                            <label style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                                <input type="checkbox" id="setting-default-bypass-ssn"
                                    style="width: 20px; height: 20px; margin-right: 10px;">
                                <span>Default "Bypass SSN" to Enabled</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Download (Overlay or Panel) -->
                <div id="step-download-panel" class="panel hidden" style="text-align: center; padding-top: 50px;">
                    <div style="font-size: 3rem; color: var(--accent-color);">✓</div>
                    <h2>File Ready</h2>
                    <br>
                    <a id="download-link" href="#" class="btn">Download .EFT File</a>
                    <br><br>
                    <button id="btn-dl-fd258" class="btn hidden"
                        style="background-color: white; color: black; border: 1px solid #ccc;">Generate Printable FD-258
                        Card</button>
                    <br><br>
                    <button id="btn-restart" class="btn btn-secondary">Start Over</button>

                    <div id="support-content"
                        style="margin-top: 40px; text-align: left; background: #222; padding: 20px; border-radius: 8px; border: 1px solid #444;">
                    </div>
                </div>


            </div>

            <!-- Footer Navigation -->
            <footer class="wizard-footer" id="main-footer">
                <button id="btn-back" class="btn btn-secondary hidden">Go Back</button>
                <div style="flex:1"></div>
                <button id="btn-next" class="btn hidden">Next Step</button>
                <button id="btn-submit" class="btn hidden">Confirm & Generate</button>
            </footer>
        </main>
    </div>

    <!-- Global Loading -->
    <div id="loading" class="hidden">
        <div class="spinner"></div>
        <p style="margin-top: 20px; color: white;">Processing...</p>
    </div>

    <script src="static/app.js"></script>
</body>

</html>